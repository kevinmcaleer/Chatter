---
layout: default
title: Account Details
permalink: /account-details/
---

<div class="account-page account-details-page">
  <div class="container">
    <h1>My Account</h1>

    <div id="account-loading" class="loading">
      <p>Loading account information...</p>
    </div>

    <div id="account-content" style="display: none;">
      <div class="account-info">
        <h2>Account Information</h2>
        <div class="info-grid">
          <div class="info-item">
            <label>Username</label>
            <span id="display-username">-</span>
          </div>
          <div class="info-item">
            <label>First Name</label>
            <span id="display-firstname">-</span>
          </div>
          <div class="info-item">
            <label>Last Name</label>
            <span id="display-lastname">-</span>
          </div>
          <div class="info-item">
            <label>Email</label>
            <span id="display-email">-</span>
          </div>
          <div class="info-item">
            <label>Date of Birth</label>
            <span id="display-dob">-</span>
          </div>
          <div class="info-item">
            <label>Status</label>
            <span id="display-status" class="status-badge">-</span>
          </div>
          <div class="info-item">
            <label>Account Created</label>
            <span id="display-created">-</span>
          </div>
        </div>
      </div>

      <div class="account-actions">
        <h2>Account Management</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="showEditForm()">
            Edit Profile
          </button>
          <a href="/password-reset/" class="btn btn-secondary">
            Change Password
          </a>
          <button class="btn btn-danger" onclick="confirmDeleteAccount()">
            Delete Account
          </button>
          <button class="btn btn-outline" onclick="logout()">
            Logout
          </button>
        </div>
      </div>

      <div id="edit-form-section" style="display: none;">
        <h2>Edit Profile</h2>
        <form id="edit-form">
          <div class="form-group">
            <label for="firstname">First Name *</label>
            <input type="text" id="firstname" name="firstname" required>
          </div>

          <div class="form-group">
            <label for="lastname">Last Name *</label>
            <input type="text" id="lastname" name="lastname" required>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required>
          </div>

          <div class="form-group">
            <label for="date_of_birth">Date of Birth</label>
            <input type="date" id="date_of_birth" name="date_of_birth">
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="save-btn">
              Save Changes
            </button>
            <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
              Cancel
            </button>
          </div>

          <div id="edit-message" class="message" style="display: none;"></div>
        </form>
      </div>
    </div>

    <div id="login-prompt" style="display: none;">
      <div class="login-prompt">
        <h2>Please Log In</h2>
        <p>You need to be logged in to view your account details.</p>
        <a href="/login/" class="btn btn-primary">Go to Login</a>
      </div>
    </div>
  </div>
</div>

<style>
.account-page {
  max-width: 800px;
  margin: 50px auto;
  padding: 20px;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}

.account-info {
  background-color: #f8f9fa;
  padding: 25px;
  border-radius: 8px;
  margin-bottom: 30px;
}

.account-info h2 {
  margin-top: 0;
  margin-bottom: 20px;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}

.info-item {
  display: flex;
  flex-direction: column;
}

.info-item label {
  font-weight: bold;
  color: #555;
  font-size: 14px;
  margin-bottom: 5px;
}

.info-item span {
  font-size: 16px;
  color: #333;
}

.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: bold;
}

.status-badge.active {
  background-color: #d4edda;
  color: #155724;
}

.status-badge.inactive {
  background-color: #f8d7da;
  color: #721c24;
}

.account-actions {
  margin-bottom: 30px;
}

.account-actions h2 {
  margin-bottom: 15px;
}

.action-buttons {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  text-decoration: none;
  display: inline-block;
  text-align: center;
}

.btn-primary {
  background-color: #007bff;
  color: white;
}

.btn-primary:hover {
  background-color: #0056b3;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background-color: #545b62;
}

.btn-danger {
  background-color: #dc3545;
  color: white;
}

.btn-danger:hover {
  background-color: #c82333;
}

.btn-outline {
  background-color: white;
  color: #007bff;
  border: 2px solid #007bff;
}

.btn-outline:hover {
  background-color: #007bff;
  color: white;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#edit-form-section {
  background-color: #f8f9fa;
  padding: 25px;
  border-radius: 8px;
  margin-top: 30px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.form-group input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
  box-sizing: border-box;
}

.form-actions {
  margin: 20px 0;
  display: flex;
  gap: 10px;
}

.message {
  padding: 12px;
  border-radius: 4px;
  margin-top: 15px;
}

.message.success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.message.error {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.login-prompt {
  text-align: center;
  padding: 40px;
  background-color: #f8f9fa;
  border-radius: 8px;
}
</style>

<script src="/assets/js/account-api.js"></script>
<script>
(function() {
  const loadingDiv = document.getElementById('account-loading');
  const contentDiv = document.getElementById('account-content');
  const loginPromptDiv = document.getElementById('login-prompt');
  const editFormSection = document.getElementById('edit-form-section');
  const editForm = document.getElementById('edit-form');
  const editMessage = document.getElementById('edit-message');
  const saveBtn = document.getElementById('save-btn');

  let currentUser = null;

  // Check if user is logged in
  if (!AccountAPI.isLoggedIn()) {
    loadingDiv.style.display = 'none';
    loginPromptDiv.style.display = 'block';
    return;
  }

  // Load account data
  async function loadAccountData() {
    try {
      currentUser = await AccountAPI.getAccount();
      displayAccountInfo(currentUser);
      loadingDiv.style.display = 'none';
      contentDiv.style.display = 'block';
    } catch (error) {
      console.error('Failed to load account:', error);
      loadingDiv.innerHTML = `
        <p style="color: red;">Failed to load account information.</p>
        <p>${error.message}</p>
        <button class="btn btn-primary" onclick="location.reload()">Retry</button>
        <button class="btn btn-secondary" onclick="logout()">Logout</button>
      `;
    }
  }

  function displayAccountInfo(user) {
    document.getElementById('display-username').textContent = user.username;
    document.getElementById('display-firstname').textContent = user.firstname;
    document.getElementById('display-lastname').textContent = user.lastname;
    document.getElementById('display-email').textContent = user.email;

    if (user.date_of_birth) {
      const date = new Date(user.date_of_birth);
      document.getElementById('display-dob').textContent = date.toLocaleDateString();
    } else {
      document.getElementById('display-dob').textContent = 'Not provided';
    }

    const statusSpan = document.getElementById('display-status');
    statusSpan.textContent = user.status;
    statusSpan.className = `status-badge ${user.status}`;

    if (user.created_at) {
      const created = new Date(user.created_at);
      document.getElementById('display-created').textContent = created.toLocaleDateString();
    }
  }

  window.showEditForm = function() {
    // Populate form with current values
    document.getElementById('firstname').value = currentUser.firstname;
    document.getElementById('lastname').value = currentUser.lastname;
    document.getElementById('email').value = currentUser.email;

    if (currentUser.date_of_birth) {
      const date = new Date(currentUser.date_of_birth);
      document.getElementById('date_of_birth').value = date.toISOString().split('T')[0];
    }

    editFormSection.style.display = 'block';
    editFormSection.scrollIntoView({ behavior: 'smooth' });
  };

  window.cancelEdit = function() {
    editFormSection.style.display = 'none';
    editMessage.style.display = 'none';
    editForm.reset();
  };

  function showEditMessage(text, type) {
    editMessage.textContent = text;
    editMessage.className = `message ${type}`;
    editMessage.style.display = 'block';
  }

  editForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    editMessage.style.display = 'none';

    const updates = {
      firstname: document.getElementById('firstname').value,
      lastname: document.getElementById('lastname').value,
      email: document.getElementById('email').value
    };

    const dob = document.getElementById('date_of_birth').value;
    if (dob) {
      updates.date_of_birth = dob + 'T00:00:00';
    }

    saveBtn.disabled = true;
    saveBtn.textContent = 'Saving...';

    try {
      currentUser = await AccountAPI.updateAccount(updates);
      displayAccountInfo(currentUser);
      showEditMessage('Profile updated successfully!', 'success');

      setTimeout(() => {
        window.cancelEdit();
      }, 2000);

    } catch (error) {
      showEditMessage(error.message || 'Failed to update profile.', 'error');
    } finally {
      saveBtn.disabled = false;
      saveBtn.textContent = 'Save Changes';
    }
  });

  window.confirmDeleteAccount = function() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
      if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
        deleteAccount();
      }
    }
  };

  async function deleteAccount() {
    try {
      await AccountAPI.deleteAccount();
      alert('Account deleted successfully.');
      window.location.href = '/';
    } catch (error) {
      alert('Failed to delete account: ' + error.message);
    }
  }

  window.logout = function() {
    AccountAPI.logout();
    window.location.href = '/login/';
  };

  // Load account data on page load
  loadAccountData();
})();
</script>
